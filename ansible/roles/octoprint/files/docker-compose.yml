# More info at https://github.com/pi-hole/docker-pi-hole/ and https://docs.pi-hole.net/

services:
  octoprint:
    image: octoprint/octoprint:1.11.7
    restart: unless-stopped
    ports:
      - "5000:5000"
    volumes:
      - ./octoprint:/octoprint
    devices:
      - /dev/ttyACM0:/dev/ttyACM0
      - /dev/video0:/dev/video0
    environment:
      - TZ=Europe/Berlin
      - ENABLE_MJPG_STREAMER=false
      - CAMERA_DEV=/dev/video0
  spoolman:
    image: ghcr.io/donkie/spoolman:0.23.1
    restart: unless-stopped
    security_opt:
      - seccomp=unconfined  # Add this to allow proper time operations
    volumes:
      # Mount the host machine's ./data directory into the container's /home/app/.local/share/spoolman directory
      - type: bind
        source: ./spoolman # This is where the data will be stored locally. Could also be set to for example `source: /home/pi/printer_data/spoolman`.
        target: /home/app/.local/share/spoolman # Do NOT modify this line
    ports:
      # Map the host machine's port 7912 to the container's port 8000
      - "7913:8000"
    environment:
      - TZ=Europe/Berlin # Optional, defaults to UTC
      - SPOOLMAN_METRICS_ENABLED=true
  autorestic:
    image: pascaliske/autorestic:latest
    restart: unless-stopped
    environment:
      - RESTIC_HOST=${RESTIC_HOST}
    volumes:
      - ./autorestic/config.yml:/etc/autorestic/config.yml
      - ./spoolman:/backups/spoolman
      - ./octoprint:/backups/octoprint
      - ./autorestic/cron:/etc/cron/
    entrypoint: [ "/bin/sh", "/etc/cron/start_cron.sh" ]
